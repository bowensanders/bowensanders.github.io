
<html>
  <head>
     <title>Metamask Guestbook Test</title>
  </head>
  <body>
  <p>
    Sign the Guestbook!
  </p>
  <div id="meta-mask-required"></div>
  <fieldset>
<!--    
    <label> Ether:
      <input type="text" id="amount"></input>
    </label>
    <button onclick="send()">Donate to the Author</button>
-->
    <label>From:
        <input type="text" id="msgFrom"></input>
    </label>
    <br>
    <label>Message:
        <input type="text" id="msgTxt"></input>
    </label>
    <br>
    <label>URL:
        <input type="text" id="msgUrl"></input>
    </label>
    <br>
    <label>value:
        <input type="text" id="msgVal"></input>
    </label>
    <button onclick="writeGuestbook()">Test Message Sender</button>
    <div id="response"></div>
  </fieldset>

  <script>
    // variable setup
    var smartWedContAddress;

    // get query variable
    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split('&');
        for (var i=0; i<vars.length; i++) {
            var pair = vars[i].split('=');
            if (decodeURIComponent(pair[0]) == variable) {
                return decodeURIComponent(pair[1]);
            }
        }
    } 

    // taken from smartwed page to get address of target contract
    function setWedContAddr() {
        smartWedContAddr = getQueryVariable('smartWedAddress');
        if (smartWedContAddr != null) {
            // alert(smartWedContAddr);
        } else {
            // smartWedContAddr = '0xd09B6E3C8FB7E05e248197EC45c38cD338d66C1a';
            
            // rinkeby test contract 
            smartWedContAddr = '0x16A594158D24E225c6c11f916E518025b75b0B5C';
        }
        // alert(smartWedContAddr);
    }

    // MetaMask injects the web3 library for us.
    window.onload = function() {
      if (typeof web3 === 'undefined') {
        document.getElementById('meta-mask-required').innerHTML = 'You need <a href="https://metamask.io/">MetaMask</a> browser plugin to run this example'
      }
      setWedContAddr();
    }

    // function to send the transaction on button press
    function send() {
      web3.eth.sendTransaction({
        from: web3.eth.coinbase,
        to: smartWedContAddr,
        value: web3.toWei(document.getElementById("amount").value, 'ether')
      }, function(error, result) {
        if (!error) {
          document.getElementById('response').innerHTML = 'Success: <a href="https://testnet.etherscan.io/tx/' + result + '"> View Transaction </a>'
        } else {
          document.getElementById('response').innerHTML = '<pre>' + error + '</pre>'
        }
      })
    }

    function writeGuestbook(){
        messageFrom = document.getElementById("msgFrom").value;
        messageTxt = document.getElementById("msgTxt").value;
        messageUrl = document.getElementById("msgUrl").value;
        messageValue = document.getElementById("msgVal").value;
        alert(messageTxt);
        MyContract = web3.eth.contract([{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"messages","outputs":[{"name":"date","type":"uint256"},{"name":"nameFrom","type":"string"},{"name":"text","type":"string"},{"name":"url","type":"string"},{"name":"value","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"nameFrom","type":"string"},{"name":"text","type":"string"},{"name":"url","type":"string"}],"name":"sendMessage","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"marriageDate","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"majorEvents","outputs":[{"name":"date","type":"uint256"},{"name":"name","type":"string"},{"name":"description","type":"string"},{"name":"url","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"name","type":"string"},{"name":"description","type":"string"},{"name":"url","type":"string"}],"name":"setMajorEvent","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"acceptOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"partner2","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"partner1","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"changeOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_dst","type":"address"},{"name":"_value","type":"uint256"},{"name":"_data","type":"bytes"}],"name":"execute","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"status","type":"string"},{"name":"url","type":"string"}],"name":"setStatus","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"vows","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"marriageStatus","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"newOwner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"numberOfMajorEvents","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_partner1","type":"string"},{"name":"_partner2","type":"string"},{"name":"_vows","type":"string"},{"name":"url","type":"string"}],"name":"createMarriage","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"numberOfMessages","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_owner","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"name","type":"string"},{"indexed":false,"name":"description","type":"string"},{"indexed":false,"name":"url","type":"string"}],"name":"MajorEvent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"name","type":"string"},{"indexed":false,"name":"description","type":"string"},{"indexed":false,"name":"url","type":"string"},{"indexed":false,"name":"value","type":"uint256"}],"name":"MessageSent","type":"event"}]);
        myContractInstance = MyContract.at(smartWedContAddr);
        myContractInstance.sendMessage(messageFrom, messageTxt, messageUrl, messageValue, function(error, result) {
        if (!error) {
          document.getElementById('response').innerHTML = 'Success: <a href="https://testnet.etherscan.io/tx/' + result + '"> View Transaction </a>'
        } else {
          document.getElementById('response').innerHTML = '<pre>' + error + '</pre>'
        }
      })
    }
  </script>
  </body>
</html>